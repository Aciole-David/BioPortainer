version: '2'

services:
  bioportainer-panel:
    image: bioportainer/bioportainer-panel
    container_name: "bioportainer-panel"
    stdin_open: true
    restart: always
    user: ${CURRENT_UID}
    ports:
      - "9000:9000"
    networks:
      - bioportainer-local
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${PWD}/bioportainer/bioportainer_data:/data
      
  bioportainer-pipeline-runner:
    image: bioportainer/bioportainer-pipeline-runner
    container_name: "bioportainer-pipeline-runner"
    privileged: true
    stdin_open: true
    restart: always
    user: ${CURRENT_UID}
    ports:
      - "5000:5000"
      - "7000:7000"
      - "8888:8888"
    networks:
      - bioportainer-local
    volumes:
      - ${PWD}/bioportainer/bioportainer_workdir:/root/workdir/data
      - ${PWD}/bioportainer/bioportainer_nextflow:/root/workdir/.nextflow/assets/nextflow-io/
      
  bioportainer-watchtower:
    image: v2tec/watchtower
    stdin_open: true
    restart: always
    container_name: "bioportainer-watchtower"
    command: --cleanup portainer-base bioportainer-watchtower bioportainer-pipeline-runner
    networks:
      - bioportainer-local
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

networks:
  bioportainer-local:
    driver: bridge

volumes:
    bioportainer_data:
    bioportainer_workdir:
    bioportainer_nextflow:
